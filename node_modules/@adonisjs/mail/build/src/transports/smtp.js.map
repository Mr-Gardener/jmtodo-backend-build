{"version":3,"sources":["../../../src/transports/smtp.ts"],"sourcesContent":["/*\n * @adonisjs/mail\n *\n * (c) AdonisJS\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n */\n\nimport nodemailer from 'nodemailer'\nimport type NodemailerTransport from 'nodemailer/lib/smtp-transport/index.js'\n\nimport debug from '../debug.js'\nimport { MailResponse } from '../mail_response.js'\nimport type { SMTPConfig, NodeMailerMessage, MailTransportContract } from '../types.js'\n\n/**\n * SMTP transport uses the Nodemailer inbuilt transport for sending\n * emails\n */\nexport class SMTPTransport implements MailTransportContract {\n  #config: SMTPConfig\n  #transporter?: nodemailer.Transporter<NodemailerTransport.SentMessageInfo>\n\n  constructor(config: SMTPConfig) {\n    this.#config = config\n  }\n\n  /**\n   * Create transporter instance\n   */\n  #createTransporter() {\n    if (this.#transporter) {\n      return this.#transporter\n    }\n\n    this.#transporter = nodemailer.createTransport(this.#config as NodemailerTransport.Options)\n    return this.#transporter\n  }\n\n  /**\n   * Send message\n   */\n  async send(\n    message: NodeMailerMessage\n  ): Promise<MailResponse<NodemailerTransport.SentMessageInfo>> {\n    const transporter = this.#createTransporter()\n    const smtpResponse = await transporter.sendMail(message)\n    return new MailResponse(smtpResponse.messageId, smtpResponse.envelope, smtpResponse)\n  }\n\n  /**\n   * Close transporter connection, helpful when using connections pool\n   */\n  async close() {\n    if (!this.#transporter) {\n      return\n    }\n\n    debug('closing smtp transport')\n    this.#transporter.close()\n    this.#transporter = undefined\n  }\n}\n"],"mappings":";;;;;;;;;;;AASA,OAAOA,gBAAgB;AAWhB,IAAMC,gBAAN,MAAMA;EApBb,OAoBaA;;;EACX;EACA;EAEAC,YAAYC,QAAoB;AAC9B,SAAK,UAAUA;EACjB;;;;EAKA,qBAAkB;AAChB,QAAI,KAAK,cAAc;AACrB,aAAO,KAAK;IACd;AAEA,SAAK,eAAeC,WAAWC,gBAAgB,KAAK,OAAO;AAC3D,WAAO,KAAK;EACd;;;;EAKA,MAAMC,KACJC,SAC4D;AAC5D,UAAMC,cAAc,KAAK,mBAAkB;AAC3C,UAAMC,eAAe,MAAMD,YAAYE,SAASH,OAAAA;AAChD,WAAO,IAAII,aAAaF,aAAaG,WAAWH,aAAaI,UAAUJ,YAAAA;EACzE;;;;EAKA,MAAMK,QAAQ;AACZ,QAAI,CAAC,KAAK,cAAc;AACtB;IACF;AAEAC,kBAAM,wBAAA;AACN,SAAK,aAAaD,MAAK;AACvB,SAAK,eAAeE;EACtB;AACF;","names":["nodemailer","SMTPTransport","constructor","config","nodemailer","createTransport","send","message","transporter","smtpResponse","sendMail","MailResponse","messageId","envelope","close","debug","undefined"]}